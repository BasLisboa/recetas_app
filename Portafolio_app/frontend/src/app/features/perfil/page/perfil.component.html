<ion-header>
  <ion-toolbar class="toolbar-profile">
    <ion-title>
      <ion-icon name="person-circle-outline" slot="start"></ion-icon>
      Perfil
    </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="abrirModalEditar()" class="edit-btn">
        <ion-icon name="settings-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="profile-bg ion-padding" scroll-y="true">
  <!-- CABECERA CON AVATAR -->
  <div class="profile-header animate-in">
    <div class="avatar-shadow">
      <ion-avatar class="profile-avatar">
        <img [src]="usuario.avatar_url || 'assets/avatar-default.png'" />
      </ion-avatar>
    </div>
    <div class="profile-user-info">
      <h2>{{ usuario.nombre_cliente || 'Nombre no disponible' }}</h2>
      <p>{{ usuario.email || 'Email no disponible' }}</p>
    </div>
  </div>

  <!-- DATOS CLAVE E IMC -->
  <div class="profile-cards-row">
    <div class="profile-card imc animate-card">
      <div class="imc-chart-circle">
        <span class="imc-value">{{ imcValor }}</span>
        <span class="imc-label">{{ categoriaIMC }}</span>
      </div>
      <div class="imc-chart-caption">IMC</div>
    </div>
    <div class="profile-card animate-card">
      <div class="profile-card-label">Edad</div>
      <div class="profile-card-value">{{ edad ? edad + ' años' : 'No definida' }}</div>
    </div>
    <div class="profile-card animate-card">
      <div class="profile-card-label">Peso</div>
      <div class="profile-card-value">{{ usuario.peso || '--' }} <span>kg</span></div>
    </div>
    <div class="profile-card animate-card">
      <div class="profile-card-label">Estatura</div>
      <div class="profile-card-value">{{ usuario.estatura || '--' }} <span>m</span></div>
    </div>
    <div class="profile-card animate-card">
      <div class="profile-card-label">Sexo</div>
      <div class="profile-card-value">{{ usuario.sexo || '--' }}</div>
    </div>
    <div class="profile-card animate-card">
      <div class="profile-card-label">Alergias</div>
      <div class="profile-card-value">{{ usuario.alergias || '--' }}</div>
    </div>
  </div>

  <!-- LISTA DE INFORMACIÓN DETALLADA -->
  <ion-list class="profile-info-list animate-in">
      <ion-card *ngIf="tdee > 0" class="tdee-card animate-in">
    <ion-card-header>
      <ion-card-title>Necesidades Nutricionales Estimadas</ion-card-title>
      <ion-card-subtitle>Basado en tus datos corporales</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-item lines="none">
        <ion-label>Calorías recomendadas (TDEE)</ion-label>
        <ion-note slot="end">{{ tdee }} kcal</ion-note>
      </ion-item>
      <ion-item lines="none">
        <ion-label>Proteínas recomendadas</ion-label>
        <ion-note slot="end">{{ proteinasRecomendadas }} g</ion-note>
      </ion-item>
      <ion-item lines="none">
        <ion-label>Grasas recomendadas</ion-label>
        <ion-note slot="end">{{ grasasRecomendadas }} g</ion-note>
      </ion-item>
    </ion-card-content>
  </ion-card>


    
    <ion-card *ngIf="resumenNutri?.totales && (
      resumenNutri.totales.totalCalorias > 0 ||
      resumenNutri.totales.totalProteinas > 0 ||
      resumenNutri.totales.totalGrasas > 0
      )" class="macro-card">
      <ion-card-header>
        <ion-card-title>Balance Nutricional de Mis Recetas</ion-card-title>
        <ion-card-subtitle>Basado en los ingredientes de tus recetas creadas</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-item lines="none">
          <ion-label>Calorías totales</ion-label>
          <ion-note slot="end">{{ resumenNutri?.totales?.totalCalorias || 0 }} kcal</ion-note>
        </ion-item>
        <ion-item lines="none">
          <ion-label>Proteínas totales</ion-label>
          <ion-note slot="end">{{ resumenNutri?.totales?.totalProteinas || 0 }} g</ion-note>
        </ion-item>
        <ion-item lines="none">
          <ion-label>Grasas totales</ion-label>
          <ion-note slot="end">{{ resumenNutri?.totales?.totalGrasas || 0 }} g</ion-note>
        </ion-item>
      
        <canvas baseChart
                [data]="macroChartData"
                [options]="macroChartOptions"
                chartType="bar"
                style="margin-top: 20px;">
        </canvas>
      </ion-card-content>
    </ion-card>
    <ion-card *ngIf="resumenNutri && resumenNutri.totales.totalCalorias === 0 
                && resumenNutri.totales.totalProteinas === 0 
                && resumenNutri.totales.totalGrasas === 0">
      <ion-card-content>
        <p class="ion-text-center">Aún no has creado recetas con información nutricional.</p>
      </ion-card-content>
    </ion-card>

    <!-- Puedes agregar aquí más info relevante -->
    <div class="charts">
      <app-macro-chart [data]="macroChartData"></app-macro-chart>
    </div>
  </ion-list>

 


  <div class="profile-actions" style="margin-bottom: 60px;">
    <ion-button expand="block" color="primary" (click)="abrirModalEditar()" class="pulse">
      <ion-icon slot="start" name="create-outline"></ion-icon>
      Editar Perfil
    </ion-button>
    <ion-button expand="block" class="logout-button" (click)="cerrarSesion()">
      Cerrar Sesión
    </ion-button>
  </div>

</ion-content>
<app-tab-menu></app-tab-menu>
