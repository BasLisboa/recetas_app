<ion-header translucent></ion-header>
<ion-content fullscreen class="home-content">

  <!-- HERO: Carrusel animado -->
  <div class="hero-carousel">
    <div class="carousel-track" [style.transform]="'translateX(-' + (carouselIndex * 100) + '%)'">
      <div class="carousel-slide" *ngFor="let item of carouselItems">
        <img [src]="item.image" alt="slide" />
        <div class="slide-caption">
          <h2>{{ item.title }}</h2>
          <p>{{ item.subtitle }}</p>
        </div>
      </div>
    </div>
    <div class="carousel-dots">
      <span *ngFor="let dot of carouselItems; let i=index"
            [class.active]="i===carouselIndex"
            (click)="goToSlide(i)"></span>
    </div>
  </div>

  <!-- Buscador bonito -->
  <div class="search-card animate-in">
    <ion-segment [(ngModel)]="tipoBusqueda" value="ingrediente">
      <ion-segment-button value="ingrediente">
        <ion-label>Ingrediente</ion-label>
      </ion-segment-button>
      <ion-segment-button value="nombre">
        <ion-label>Receta</ion-label>
      </ion-segment-button>
    </ion-segment>
    <ion-searchbar
      [placeholder]="tipoBusqueda === 'ingrediente' ? 'Buscar ingrediente...' : 'Buscar receta...'"
      [(ngModel)]="textoBusqueda"
      (ionClear)="reset()"
      [animated]="true">
    </ion-searchbar>
    <ion-button
      expand="block"
      (click)="buscarRecetas()"
      [disabled]="!textoBusqueda.trim()"
      class="search-button">
      Buscar
    </ion-button>
  </div>

  <!-- RESULTADOS DE BÃšSQUEDA -->
  <ng-container *ngIf="busquedaActiva; else defaultSection">
    <h2
      class="section-message animate-in"
      [ngClass]="{
        'found': recetas.length > 0,
        'not-found': recetas.length === 0
      }">
      {{ recetas.length
         ? 'Resultados para "' + textoBusqueda + '"'
         : 'No se encontraron recetas para "' + textoBusqueda + '"' }}
    </h2>
    <ion-grid>
      <ion-row>
        <ion-col
          size="12" size-md="6" size-lg="4"
          *ngFor="let r of recetas; let i = index"
        >
          <ion-card
            class="recipe-card animate-card"
            [@cardAnim]="i"
            (click)="verDetalles(r)"
          >
            <div class="card-image-wrapper">
              <ion-img
                class="card-image"
                [src]="r.imagen_url"
                alt="{{ r.nombre_receta }}"
                title="{{ r.nombre_receta }}">
              </ion-img>
            </div>
            <ion-card-header>
              <ion-card-title>{{ r.nombre_receta }}</ion-card-title>
            </ion-card-header>
            <ion-button expand="block" fill="clear" color="primary" >
              Ver Detalles
              <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
            </ion-button>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ng-container>

  <!-- SECCIÃ“N POR DEFECTO -->
  <ng-template #defaultSection>
    <h2 class="section-title animate-in">Recetas recomendadas</h2>
    <ion-grid>
      <ion-row>
        <ion-col
          size="12" size-md="6" size-lg="4"
          *ngFor="let r of recetas; let i = index"
        >
          <ion-card
            class="recipe-card animate-card"
            [@cardAnim]="i"
            (click)="verDetalles(r)"
          >
            <div class="card-image-wrapper">
              <ion-img
                class="card-image"
                [src]="r.imagen_url"
                alt="{{ r.nombre_receta }}"
                title="{{ r.nombre_receta }}">
              </ion-img>
            </div>
            <ion-card-header>
              <ion-card-title>{{ r.nombre_receta }}</ion-card-title>
            </ion-card-header>
            <ion-button expand="block" fill="clear" color="primary"> 
              Ver Detalles
              <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
            </ion-button>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ng-template>

</ion-content>

<ion-footer>
  <ion-toolbar color="light">
    <app-tab-menu></app-tab-menu>
  </ion-toolbar>
</ion-footer>

<!-- Pelota flotante -->
<div class="chatball bounce-in" (click)="toggleChat()">
  ðŸ’¬
</div>

<div 
  class="chat-overlay" 
  *ngIf="showChat" 
  (click)="minimizarChat()">
</div>
<app-chatbot [class.hidden]="!showChat"></app-chatbot>
